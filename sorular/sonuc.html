<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Sonuçlar</title>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      max-width: 600px;
      margin: 10px auto;
      text-align: center;
      background-color: #f9f9f9;
      color: #333;
    }
    h1 { margin: 0 0 2px; font-size: 18px; }

    /* Katılımcı İsmi Stili */
    #participantDisplay {
      font-size: 16px;
      color: #0077cc;
      margin-bottom: 8px;
      font-weight: 600;
    }

    /* Skor Kutusu */
    .result-box {
      border: 1px solid #e0e0e0;
      padding: 6px 15px;
      border-radius: 10px;
      background: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      font-size: 14px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    .result-box p { margin: 0; }
    .score {
      font-size: 32px;
      font-weight: bold;
      color: #2e7d32;
    }
    #detailText {
      color: #555;
      font-size: 13px;
    }

    /* Detaylı Liste */
    .breakdown-container {
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      padding: 6px 10px;
      text-align: left;
      margin-bottom: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .breakdown-title {
      font-size: 13px;
      font-weight: bold;
      margin-bottom: 4px;
      text-align: center;
      color: #444;
    }
    .breakdown-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2px;
    }
    .result-item {
      display: flex;
      justify-content: space-between;
      padding: 3px 8px;
      font-size: 12px;
      border-radius: 4px;
    }
    .result-item.correct {
      background-color: #e8f5e9;
      color: #2e7d32;
    }
    .result-item.wrong {
      background-color: #ffebee;
      color: #c62828;
    }
    .badge {
      font-weight: bold;
    }

    /* Butonlar */
    .btn-group {
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    button {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      transition: opacity 0.2s;
    }
    button:hover { opacity: 0.9; }
    
    #backBtn { background: #1976d2; color: white; }
    #resetBtn { background: #d32f2f; color: white; }
  </style>
</head>
<body>

  <h1>Çalışma Sonuçları</h1>
  
  <div id="participantDisplay"></div>

  <div class="result-box">
    <div>
      <p>Toplam Doğru Sayınız</p>
      <p id="detailText"></p>
    </div>
    <div class="score" id="scoreValue">0</div>
  </div>

  <div class="breakdown-container" id="breakdownContainer" style="display:none;">
    <div class="breakdown-title">Soru Bazlı Detaylar</div>
    <div class="breakdown-grid" id="breakdownList"></div>
  </div>

  <div class="btn-group">
    <button id="backBtn" onclick="goHome()">Başa Dön</button>
    <button id="resetBtn" onclick="resetLogs()">Sonuçları Sıfırla</button>
  </div>

  <script>
    const STORAGE_KEY = "quizLogs";

    // --- İsim Gösterme ---
    const participantName = localStorage.getItem('currentParticipant');
    if (participantName) {
      document.getElementById('participantDisplay').textContent = `Sayın ${participantName}`;
    }

    function goHome() {
      window.location.href = '../index.html'; 
    }

    function loadLogs() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const logs = JSON.parse(raw);
        return Array.isArray(logs) ? logs : [];
      } catch {
        return [];
      }
    }

    function calculateScore(logs) {
      return logs.filter(l => l.feedbackType === "correct").length;
    }

    function resetLogs() {
      if (!confirm("Tüm kayıtları silip en başa dönmek istediğinize emin misiniz?")) return;
      localStorage.removeItem(STORAGE_KEY);
      localStorage.removeItem('currentParticipant');
      window.location.href = "../index.html";
    }

    // --- Ana İşleyiş ---
    const logs = loadLogs();
    const score = calculateScore(logs);

    document.getElementById("scoreValue").textContent = score;
    const totalQuestions = logs.length;
    document.getElementById("detailText").textContent =
      totalQuestions > 0 
        ? `${totalQuestions} sorudan ${score} tanesini doğru yanıtladınız.`
        : "Henüz çözülmüş soru bulunmuyor.";

    if (totalQuestions > 0) {
      const container = document.getElementById("breakdownContainer");
      const list = document.getElementById("breakdownList");
      
      container.style.display = "block";

      logs.forEach(log => {
        const qNum = log.questionId.replace("S", ""); 
        const isCorrect = (log.feedbackType === "correct");

        const div = document.createElement("div");
        div.className = isCorrect ? "result-item correct" : "result-item wrong";

        div.innerHTML = `
          <span><strong>${qNum}. Soru</strong></span>
          <span class="badge">${isCorrect ? "✓" : "✗"}</span>
        `;
        list.appendChild(div);
      });
    }
  </script>

</body>
</html>
